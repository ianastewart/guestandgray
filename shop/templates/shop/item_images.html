{% extends "shop/shop_base.html" %}
{% load wagtailimages_tags static shop_tags bootstrap4 django_htmx %}
{% block body_class %}bg-guest-lighter{% endblock %}
{% block content_body %}
  <h3 class="my-3">{{ item.ref }} {{ item.name }}</h3>
  <a href="{% url 'item_detail' pk=item.pk %}" class="btn btn-primary mb-2">Close</a>
  <button type="button" class="btn btn-primary mb-2 js-upload-photos">
    <span class="glyphicon glyphicon-cloud-upload"></span> Upload photos
  </button>
  <input id="fileupload" type="file" name="file" multiple
         style="display: none;"
         data-url="{% url 'basic_upload' %}"
         data-form-data='{"csrfmiddlewaretoken": "{{ csrf_token }}"}'>
  <div id="images">
    {% include "shop/item_images__all.html" %}
  </div>
  <div id="modals-here"></div>
  <div class="modal fade" id="modal-progress" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content bg-light">
        <div class="modal-body">
          <h4 class="text-center mt-0">Upload photos</h4>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 0%;">0%</div>
          </div>
          <table id="gallery" class="table table-sm table-borderless">
            <thead>
            <tr>
              <th>Uploaded Photos</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
          <form method="post" id="crop_form">{% csrf_token %}
            <div class="row">
              <div class="col-8">
                {% bootstrap_field form.crop %}
                {% bootstrap_field form.limit %}
              </div>
            </div>
            <button type="submit" name="process" class="btn btn-secondary">Process images</button>
            <button type="submit" name="cancel" class="btn btn-secondary">Cancel</button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block custom_scripts %}
  {# JQUERY FILE UPLOAD SCRIPTS #}
  <script src="{% static 'shop/js/jquery-file-upload-10.31.0/vendor/jquery.ui.widget.js' %}"></script>
  <script src="{% static 'shop/js/jquery-file-upload-10.31.0/jquery.iframe-transport.js' %}"></script>
  <script src="{% static 'shop/js/jquery-file-upload-10.31.0/jquery.fileupload.js' %}"></script>
  {# PHOTOS PAGE SCRIPTS #}
  <script src="{% static 'shop/js/basic_upload.js' %}"></script>
  {#    <script src="{% static 'shop/js/image_management.js' %}"></script>#}
  <script src="https://unpkg.com/htmx.org@1.6.1"></script>
  <script src="{% static "shop/js/htmx_helper.js" %}"></script>
 <script>
document.body.addEventListener('htmx:configRequest', (event) => {
  event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
})
  </script>
{% endblock %}


