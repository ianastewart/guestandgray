{% load shop_tags %}

<li class="nav-item dropdown has-megamenu">
  <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">{% if is_archive %}Archive{% else %}
    Catalogue{% endif %}</a>
  <div class="dropdown-menu megamenu" role="menu">
    {% if is_archive %}{% archive_tree as tree %}<a href="/archive/"><h5>Browse archive items</h5></a>
    {% else %}
      {% catalogue_tree as tree %}<a href="/catalogue/"><h5>Browse items on sale</h5></a>
    {% endif %}
    <div class="row">
      {% for item in tree.children %}
        {% if item.shop and is_catalogue or item.archive and is_archive or item.children %}
          <div class="col col-lg-3">
            <div class="col-megamenu">
              <div class="card">
                <h4 class="title m-2">{{ item.text }} {% if is_archive %}Archive{% endif %}</h4>
                <ul class="list-unstyled">
                  {% for level2 in item.children %}
                    {% if level2.children %}
                      <li><a class="dropdown-item" href="{{ level2.link }}">{{ level2.text }}</a></li>
                      <ul class="list-unstyled">
                        {% for level3 in level2.children %}
                          {% if level3.shop and is_catalogue or level3.archive and is_archive or level3.children %}
                            <li><a class="dropdown-item" href="{{ level3.link }}"><span
                                class="pl-3">{{ level3.text }}</span></a></li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    {% endif %}
                    {% if level2.shop and is_catalogue or level2.archive and is_archive %}
                      <li><a class="dropdown-item" href="{{ level2.link }}">{{ level2.text }}</a></li>
                    {% endif %}
                  {% endfor %}
                </ul>
              </div>
            </div>

          </div>

        {% endif %}
      {% endfor %}
    </div>
  </div>
</li>